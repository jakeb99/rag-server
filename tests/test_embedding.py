import pytest
from app.services.embedding.embedding import create_chunks_from_text

test_text = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce nec nisl eu leo elementum pellentesque et ut lorem. Nam quis nisi blandit, suscipit arcu non, dignissim arcu. Cras venenatis nulla neque, sed porta neque sollicitudin id. Etiam tempus sodales mi, ac interdum nulla laoreet ac. Duis semper congue mauris, in cursus tortor sagittis sit amet. Nunc vitae urna metus. Sed velit nulla, venenatis ut feugiat sed, blandit quis mi. Morbi sed commodo nulla. Proin eu ornare lorem, at consectetur urna. Suspendisse auctor, nisl a volutpat laoreet, nibh turpis scelerisque ex, sed mattis odio justo vitae tellus. Praesent commodo viverra commodo. Donec et massa non elit tincidunt pellentesque. Praesent et eros nisl. Sed sed dapibus velit.Donec erat quam, gravida et risus vitae, vehicula cursus tortor. Nulla condimentum in justo sit amet dapibus. Pellentesque eleifend orci tellus, vitae rutrum nulla sodales sed. Ut dictum posuere semper. Pellentesque elementum nisl id orci convallis, vitae cursus ipsum bibendum. Donec sollicitudin venenatis lectus, vitae dictum nunc ullamcorper at. Cras sapien sem, rhoncus ut velit ac, porta bibendum leo. Etiam nunc ipsum, sodales ac posuere id, consequat pretium mi. Suspendisse potenti. Proin velit metus, tempor non odio non, dignissim ultrices velit. Morbi at dui a lorem pharetra elementum.Vivamus justo mi, lacinia in lobortis at, sagittis sit amet dui. In vitae sem vel diam volutpat faucibus ut vel urna. Pellentesque iaculis, nibh suscipit hendrerit bibendum, nulla nibh hendrerit orci, sit amet semper eros elit eu libero. Sed nibh justo, scelerisque vitae justo ut, ullamcorper pharetra enim. Sed sit amet odio risus. Cras aliquet laoreet lacus, eget vestibulum odio porttitor sed. Nullam viverra magna et quam fringilla volutpat. Ut et risus ligula. Phasellus iaculis, lorem dictum fringilla porta, leo sem mattis dolor, at volutpat sem velit in turpis. Phasellus facilisis tortor in sagittis feugiat. Nulla facilisi.Aliquam sed leo quis neque viverra aliquam. Donec purus libero, tempor nec orci a, bibendum porta dui. Fusce at elit a mauris elementum mollis eget ac eros. Quisque magna lectus, facilisis a vulputate vel, sodales sed diam. Proin eget dictum purus, quis interdum ipsum. Integer fringilla neque sit amet libero cursus placerat. Donec tortor eros, ornare in lacus id, tincidunt dapibus urna. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Quisque auctor magna quis pellentesque fermentum. Donec blandit nisl ultricies, facilisis eros laoreet, ultricies ipsum. Cras eget auctor ex, et tristique dui. Etiam in magna eget tellus ultrices faucibus. Maecenas porta tincidunt ornare. Morbi tempus ullamcorper nibh, eget commodo enim aliquam vel. Vestibulum ut odio ac dui accumsan tincidunt quis ac sem. Nunc laoreet nulla in odio facilisis, quis lobortis tortor facilisis. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Maecenas nisl neque, viverra a feugiat et, elementum non urna. Phasellus molestie posuere arcu et tincidunt. Vivamus pharetra nibh ac lacus lacinia lobortis. Nullam vestibulum dui nisl, et sollicitudin ipsum hendrerit sit amet. Donec eu turpis leo. Aenean non placerat metus. Maecenas lacus arcu, iaculis a pulvinar nec, porta in tellus. Nunc faucibus, felis vel blandit rhoncus, odio felis commodo arcu, id dictum purus lorem et eros. Etiam pellentesque erat molestie, tincidunt ex ut, rutrum libero. Morbi ullamcorper fringilla ipsum sed suscipit. Aliquam ultricies malesuada fermentum. Nulla vulputate, dolor sit amet facilisis ullamcorper, ligula nisi aliquam dui, vitae facilisis velit nulla at est. Mauris sagittis cursus ex, vitae semper ante faucibus sed. Duis a odio nec erat tincidunt bibendum.Integer ornare lorem nec purus facilisis posuere. Integer eget lacus auctor, ultrices ex ut, dapibus erat. Etiam sollicitudin vulputate sagittis. Sed tincidunt rhoncus nunc, non ultrices enim ultrices vel. Praesent ut libero."

mock_chunk_list= ['lorem ipsum dolor sit amet, consectetur adipiscing elit. fusce nec nisl eu leo elementum pellentesque et ut lorem. nam quis nisi blandit, suscipit arcu non, dignissim arcu. cras venenatis nulla neque, sed porta neque sollicitudin id. etiam tempus sodales mi, ac interdum nulla laoreet ac. duis semper congue mauris, in cursus tortor sagittis sit amet. nunc vitae urna metus. sed velit nulla, venenatis ut feugiat sed, blandit quis mi. morbi sed commodo nulla. proin eu ornare lorem, at consectetur urna. suspendisse auctor, nisl a volutpat laoreet, nibh turpis scelerisque ex, sed mattis odio justo vitae tellus. praesent commodo viverra commodo. donec et massa non elit tincidunt pellentesque. praesent et eros nisl. sed sed dapibus velit. donec erat quam, gravida et risus vitae, vehicula cursus tortor. nulla condimentum in justo sit amet dapibus. pellentesque eleifend orci tellus, vitae rutrum nulla sodales sed. ut dictum posuere semper. pellentesque elementum nisl id orci convallis, vitae cursus ipsum bibendum. donec sollicitudin venenatis lectus, vitae dictum nunc ullamcorper at. cras sapien sem, rhoncus ut velit ac, porta bibendum leo. etiam nunc ipsum, sodales ac posuere id, consequat pretium mi. suspendisse potenti. proin velit metus, tempor non odio non, dignissim ultrices velit. morbi at dui a lorem pharetra elementum. vivamus justo mi, lacinia in lobortis at', '##in velit metus, tempor non odio non, dignissim ultrices velit. morbi at dui a lorem pharetra elementum. vivamus justo mi, lacinia in lobortis at, sagittis sit amet dui. in vitae sem vel diam volutpat faucibus ut vel urna. pellentesque iaculis, nibh suscipit hendrerit bibendum, nulla nibh hendrerit orci, sit amet semper eros elit eu libero. sed nibh justo, scelerisque vitae justo ut, ullamcorper pharetra enim. sed sit amet odio risus. cras aliquet laoreet lacus, eget vestibulum odio porttitor sed. nullam viverra magna et quam fringilla volutpat. ut et risus ligula. phasellus iaculis, lorem dictum fringilla porta, leo sem mattis dolor, at volutpat sem velit in turpis. phasellus facilisis tortor in sagittis feugiat. nulla facilisi. aliquam sed leo quis neque viverra aliquam. donec purus libero, tempor nec orci a, bibendum porta dui. fusce at elit a mauris elementum mollis eget ac eros. quisque magna lectus, facilisis a vulputate vel, sodales sed diam. proin eget dictum purus, quis interdum ipsum. integer fringilla neque sit amet libero cursus placerat. donec tortor eros, ornare in lacus id, tincidunt dapibus urna. pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. quisque auctor magna quis pellentesque fermentum. donec blandit nisl ultricies, facilisis eros laoreet, ultricies ipsum. cras eget auctor ex, et tristique dui. etiam', '##tesque fermentum. donec blandit nisl ultricies, facilisis eros laoreet, ultricies ipsum. cras eget auctor ex, et tristique dui. etiam in magna eget tellus ultrices faucibus. maecenas porta tincidunt ornare. morbi tempus ullamcorper nibh, eget commodo enim aliquam vel. vestibulum ut odio ac dui accumsan tincidunt quis ac sem. nunc laoreet nulla in odio facilisis, quis lobortis tortor facilisis. orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. maecenas nisl neque, viverra a feugiat et, elementum non urna. phasellus molestie posuere arcu et tincidunt. vivamus pharetra nibh ac lacus lacinia lobortis. nullam vestibulum dui nisl, et sollicitudin ipsum hendrerit sit amet. donec eu turpis leo. aenean non placerat metus. maecenas lacus arcu, iaculis a pulvinar nec, porta in tellus. nunc faucibus, felis vel blandit rhoncus, odio felis commodo arcu, id dictum purus lorem et eros. etiam pellentesque erat molestie, tincidunt ex ut, rutrum libero. morbi ullamcorper fringilla ipsum sed suscipit. aliquam ultricies malesuada fermentum. nulla vulputate, dolor sit amet facilisis ullamcorper, ligula nisi aliquam dui, vitae facilisis velit nulla at est. mauris sagittis cursus ex, vitae semper ante faucibus sed. duis a odio nec erat tincidunt bibendum. integer ornare lorem nec purus facilisis posuere. integer eget lacus auctor, ultrices ex ut', '##us sed. duis a odio nec erat tincidunt bibendum. integer ornare lorem nec purus facilisis posuere. integer eget lacus auctor, ultrices ex ut, dapibus erat. etiam sollicitudin vulputate sagittis. sed tincidunt rhoncus nunc, non ultrices enim ultrices vel. praesent ut libero.']

def test_create_chunks_from_text():
## this test assumes a chunk size of 512 and 50 token overlap, using "jinaai/jina-embeddings-v2-small-en"
    chunks = create_chunks_from_text(test_text)
    assert chunks == mock_chunk_list
    assert len(chunks) == 4